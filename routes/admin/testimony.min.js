'use strict';const express=require("express"),app=express(),router=express.Router(),faker=require("faker"),Testimony=require("../../models/Testimony");router.all("/*",(a,c,b)=>{a.app.locals.layout="admin";b()});router.get("/",(a,c)=>{Testimony.find().populate("user").then(b=>{c.render("admin/testimony",{tests:b})}).catch(b=>console.log(b))});
router.get("/loggedUser/:id",(a,c)=>{Testimony.find({_id:a.params.id}).populate("user").then(b=>{c.render("admin/testimony/loggedInContacts",{tests:b})}).catch(b=>console.log(b))});router.get("/create",(a,c)=>{c.render("admin/testimony/create")});router.get("/dummy",(a,c)=>{c.render("admin/testimony/dummy")});router.get("/edit/:id",(a,c)=>{Testimony.findOne({_id:a.params.id}).then(b=>{c.render("admin/testimony/edit",{test:b})}).catch(b=>console.log(b))});
router.post("/create",(a,c)=>{const b=new Testimony;b.user=a.user.id;b.field=a.body.field;b.message=a.body.message;b.save().then(d=>{a.flash("success_msg","Testimony has been created successfully :)");"Admin"===loggedUser.role?c.redirect("/admin/testimony"):c.redirect(`/admin/testimony/loggedUser/${a.user.id}`)}).catch(d=>console.log(d))});
router.post("/dummy",(a,c)=>{for(let b=0;b<a.body.number;b++){const d=new Testimony;d.user=a.user.id;d.field=faker.random.word();d.message=faker.lorem.sentence();d.save().then(e=>{a.flash("success_msg",`${a.body.number} dummy testimonies has been created successfully :)`);c.redirect("/admin/testimony")}).catch(e=>console.log(e))}});
router.post("/update/:id",(a,c)=>{Testimony.findOne({_id:a.params.id}).then(b=>{Testimony.field=a.body.field;Testimony.message=a.body.message;Testimony.save().then(d=>{a.flash("success_msg","testimony has been updated successfully :)");"Admin"===loggedUser.role?c.redirect("/admin/testimony"):c.redirect(`/admin/testimony/loggedUser/${a.user.id}`)}).catch(d=>console.log(d))}).catch(b=>console.log(b))});
router.get("/delete/:id",(a,c)=>{Testimony.findOne({_id:a.params.id}).then(b=>{b.delete().then(d=>{a.flash("success_msg",`${b.field} has been deleted successfully :)`);"Admin"===loggedUser.role?c.redirect("/admin/testimony"):c.redirect(`/admin/testimony/loggedUser/${a.user.id}`)}).catch(d=>console.log(d))}).catch(b=>console.log(b))});module.exports=router;