'use strict';const express=require("express"),app=express(),router=express.Router(),Media=require("../../models/Media"),{isEmpty}=require("../../helpers/upload-helpers"),fs=require("fs");router.all("/*",(b,e,a)=>{b.app.locals.layout="admin";a()});router.get("/",(b,e)=>{Media.find().then(a=>{e.render("admin/media",{medias:a})}).catch(a=>console.log(a))});
router.post("/create",(b,e)=>{let a="";if(!isEmpty(b.files)){var c=b.files.file;a=Date.now()+"-"+c.name;c.mv("./public/uploads/"+a,d=>{d&&console.log(d)})}c=new Media;c.file=a;c.save().then(d=>{b.flash("success_msg","Media successfully uploaded");e.redirect("/admin/media")}).catch(d=>console.log(d))});
router.get("/delete/:id",(b,e)=>{Media.findOne({_id:b.params.id}).then(a=>{fs.unlink("./public/uploads/"+a.file,c=>{c&&console.log(c)});a.delete().then(c=>{b.flash("success_msg","Media successfully trashed :)")}).catch(c=>console.log(c))}).catch(a=>console.log(a))});
router.post("/multiaction",(b,e)=>{console.log(b.body.checkboxes);Media.find({_id:b.body.checkboxes}).then(a=>{a.forEach(c=>{fs.unlink("./public/uploads/"+dept.file,d=>{d&&console.log(d)});c.delete().then(d=>{b.flash("success_msg","Medias successfully trashed :)")}).catch(d=>console.log(d))})}).catch(a=>console.log(a))});module.exports=router;