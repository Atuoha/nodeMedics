'use strict';const express=require("express"),app=express(),router=express.Router(),Media=require("../../models/Media"),{isEmpty}=require("../../helpers/upload-helpers"),fs=require("fs");router.all("/*",(c,d,a)=>{c.app.locals.layout="admin";a()});router.get("/",(c,d)=>{Media.find().then(a=>{d.render("admin/media",{medias:a})}).catch(a=>console.log(a))});
router.post("/create",(c,d)=>{let a="";if(!isEmpty(c.files)){var b=c.files.file;a=Date.now()+"-"+b.name;b.mv("./public/uploads/"+a,e=>{e&&console.log(e)})}b=new Media;b.file=a;b.save().then(e=>{c.flash("success_msg","Media successfully uploaded");d.redirect("/admin/media")}).catch(e=>console.log(e))});
router.get("/delete/:id",(c,d)=>{Media.findOne({_id:c.params.id}).then(a=>{fs.unlink("./public/uploads/"+a.file,b=>{b&&console.log(b)});a.delete().then(b=>{c.flash("success_msg","Media successfully trashed :)")}).catch(b=>console.log(b))}).catch(a=>console.log(a))});module.exports=router;